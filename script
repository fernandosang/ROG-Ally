@echo off
setlocal

REM GitHub API details
set "token=YOUR_PERSONAL_ACCESS_TOKEN"
set "repo=USERNAME/REPOSITORY"  REM Replace with your GitHub username and repo name
set "file_path=storage_info.json"

REM Initialize variables
set "minValue=0"
set "color=green"

REM Get storage information for SSD (DriveType=3)
for /f "tokens=2 delims=:" %%a in ('wmic logicaldisk where "DriveType=3" get Size^, FreeSpace^, DeviceID ^| findstr /R /C:"[A-Z]"') do (
    set "totalSize=%%a"
    set /a "usedSpace=totalSize - freeSpace"
)

REM Calculate the used space percentage
set /a "value=100 * usedSpace / totalSize"

REM Create the JSON output
set "json={^
    \"postfix\": \"%%\",^
    \"color\": \"%color%\",^
    \"data\": {^
        \"minValue\": %minValue%,^
        \"value\": %value%,^
        \"maxValue\": %totalSize%^
    }^
}"

REM Update the file on GitHub using the API
curl -X PUT -H "Authorization: token %token%" -H "Accept: application/vnd.github.v3+json" ^
    -d "{\"message\":\"Update storage information\",\"content\":\"%json%\"}" ^
    "https://api.github.com/repos/%repo%/contents/%file_path%"

endlocal
