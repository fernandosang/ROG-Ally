@echo off
setlocal

REM GitHub API details
set "token=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"  REM Your personal access token
set "repo=fernandosang/ROG-Ally"  REM Your GitHub username and repo name
set "file_path=Storage.json"        REM Name of the file

REM Initialize variables
set "minValue=0"
set "color=green"

REM Get storage information for SSD (DriveType=3)
for /f "tokens=2 delims=:" %%a in ('wmic logicaldisk where "DriveType=3" get Size^, FreeSpace^, DeviceID ^| findstr /R /C:"[A-Z]"') do (
    set "totalSize=%%a"
    set /a "usedSpace=totalSize - freeSpace"
)

REM Calculate the used space percentage
set /a "value=100 * usedSpace / totalSize"

REM Create the JSON output
set "json={^
    \"postfix\": \"%%\",^
    \"color\": \"%color%\",^
    \"data\": {^
        \"minValue\": %minValue%,^
        \"value\": %value%,^
        \"maxValue\": %totalSize%^
    }^
}"

REM Encode JSON using PowerShell
for /f "delims=" %%i in ('powershell -command "[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes('%json%'))"') do set "base64json=%%i"

REM Get the current file's SHA
set "file_sha="
for /
